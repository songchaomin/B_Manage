<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:mo="https://gitee.com/aun/Timo">
<head th:replace="/common/template :: header(~{::title},~{::link},~{::style})">
    <style>
        .layui-form .layui-form-item .layui-form-label {
            width: 140px;
        }

        .upload-img {
            width: 80px;
            height: 80px;
            border: 0;
            padding-right: 2px;
        }
        /* 下拉多选样式 需要引用*/
         select[multiple]+.layui-form-select>.layui-select-title>input.layui-input{ border-bottom: 0}
        select[multiple]+.layui-form-select dd{ padding:0;}
        select[multiple]+.layui-form-select .layui-form-checkbox[lay-skin=primary]{ margin:0 !important; display:block; line-height:36px !important; position:relative; padding-left:26px;}
        select[multiple]+.layui-form-select .layui-form-checkbox[lay-skin=primary] span{line-height:36px !important;padding-left: 10px; float:none;}
        select[multiple]+.layui-form-select .layui-form-checkbox[lay-skin=primary] i{ position:absolute; left:10px; top:0; margin-top:9px;}
        .multiSelect{ line-height:normal; height:auto; padding:4px 10px; overflow:hidden;min-height:38px; margin-top:-38px; left:0; z-index:99;position:relative;background:none;}
        .multiSelect a{ padding:2px 5px; background:#908e8e; border-radius:2px; color:#fff; display:block; line-height:20px; height:20px; margin:2px 5px 2px 0; float:left;}
        .multiSelect a span{ float:left;}
        .multiSelect a i {float:left;display:block;margin:2px 0 0 2px;border-radius:2px;width:8px;height:8px;padding:4px;position:relative;-webkit-transition:all .3s;transition:all .3s}
        .multiSelect a i:before, .multiSelect a i:after {position:absolute;left:8px;top:2px;content:'';height:12px;width:1px;background-color:#fff}
        .multiSelect a i:before {-webkit-transform:rotate(45deg);transform:rotate(45deg)}
        .multiSelect a i:after {-webkit-transform:rotate(-45deg);transform:rotate(-45deg)}
        .multiSelect a i:hover{ background-color:#545556;}
        .multiOption{display: inline-block; padding: 0 5px;cursor: pointer; color: #999;}
        .multiOption:hover{color: #5FB878}

        @font-face {font-family: "iconfont"; src: url('data:application/x-font-woff;charset=utf-8;base64,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') format('woff')}
        .iconfont {font-family:"iconfont" !important;font-size:16px;font-style:normal;-webkit-font-smoothing: antialiased;-moz-osx-font-smoothing: grayscale;}
        .icon-fanxuan:before { content: "\e837"; }
        .icon-quanxuan:before { content: "\e623"; }
        .icon-qingkong:before { content: "\e63e"; }
    </style>
</head>
<body>
<div class="layui-form timo-compile" style="margin: 0 auto;width: 700px;padding-top: 5px;">
    <form th:action="@{/task/add}">
        <div class="layui-tab layui-tab-card">
            <ul class="layui-tab-title">
                <li class="layui-this">任务基本信息</li>
                <li>任务标签</li>
            </ul>
            <div class="layui-tab-content" style="background-color: white;">
                <input type="hidden" name="id" id="idkey">
                <div class="layui-tab-item layui-show">
                    <!--基本信息-->
                    <div class="layui-form-item">
                        <label class="layui-form-label required">任务名称</label>
                        <div class="layui-input-inline">
                            <input class="layui-input" type="text" name="taskName" placeholder="请输入任务名称">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label required">任务类型</label>
                        <div class="layui-input-inline">
                            <input type="radio" name="taskType" value="淘宝" title="淘宝" >
                            <input type="radio" name="taskType" value="京东" title="京东">
                            <input type="radio" name="taskType" value="拼多多" title="拼多多">
                            <input type="radio" name="taskType" value="抖音" title="抖音">

                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label required">绑定店铺</label>
                        <div class="layui-input-inline">
                            <input class="layui-input" type="text" name="shopName" id="shopName" readonly placeholder="请选择店铺">
                        </div>
                        <div class="layui-input-inline">
                            <button type="button" class="layui-btn" id="chsShop">选择店铺</button>
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label required">宝贝链接</label>
                        <div class="layui-input-inline">
                            <input class="layui-input" type="text" name="babyLink" placeholder="请输入宝贝链接">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label required">宝贝关键字</label>
                        <div class="layui-input-inline">
                            <input class="layui-input" type="text" name="babyKey" placeholder="请输入宝贝关键字">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label required">宝贝规格(毛重)</label>
                        <div class="layui-input-inline">
                            <input class="layui-input" type="text" name="babySpec" placeholder="请输入宝贝规格">
                        </div>
                        <div class="layui-input-inline">
                           <span>克</span>
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label required">宝贝本金(元)</label>
                        <div class="layui-input-inline">
                            <input class="layui-input" type="text" name="babyPrice" placeholder="请输入宝贝本金">
                        </div>

                        <div class="layui-input-inline">
                            <button type="button" class="layui-btn" id="chsPrice">服务价目表</button>
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label required">是否关注店铺</label>
                        <div class="layui-input-inline">
                            <input type="radio" name="attentionStoreFlag" value="1" title="是" >
                            <input type="radio" name="attentionStoreFlag" value="0" title="否">
                        </div>
                    </div>

                    <div class="layui-form-item">
                        <label class="layui-form-label required">是否收藏宝贝</label>
                        <div class="layui-input-inline">
                            <input type="radio" name="collectBabyFlag" value="1" title="是" >
                            <input type="radio" name="collectBabyFlag" value="0" title="否">
                        </div>
                    </div>
                    <div class="layui-form-item">
                    <div class="layui-upload">
                        <label class="layui-form-label required">宝贝主图</label>
                        <div class="layui-input-inline">
                            <button type="button" class="layui-btn" id="babyPic">上传图片</button>
                            <blockquote style="margin-top: 5px;">
                                <div class="layui-upload-list" id="babyPicImg"></div>
                            </blockquote>
                            <input type="hidden" name="babyPic" id="babyPicText"/>
                        </div>
                    </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label required">任务人数</label>
                        <div class="layui-input-inline">
                            <input class="layui-input" type="text" name="personNum" placeholder="请输入任务人数">
                        </div>
                        <div class="layui-input-inline">
                            <span>【不可为0】</span>
                        </div>
                    </div>
                </div>
                <div class="layui-tab-item">
                    <!--标签信息-->
                    <div class="layui-form-item">
                        <label class="layui-form-label required" >性别</label>
                        <div class="layui-input-inline">
                            <select name="sex"  multiple lay-tools >
                                <option value="男">男</option>
                                <option value="女" >女</option>
                                <option value="无所谓">无所谓</option>
                            </select>
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label required" >年龄</label>
                        <div class="layui-input-inline">
                            <select name="age" multiple  lay-tools mo:dict="AGE_RANGE"
                                    mo-selected="${param.status}"></select>
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label required" >地区</label>
                        <div class="layui-input-inline">
                            <select name="area" multiple  lay-tools mo:dict="ARE_RANGE"
                                    mo-selected="${param.status}"></select>
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label required" >子女年龄</label>
                        <div class="layui-input-inline">
                            <select name="childAge" multiple  lay-tools  mo:dict="CHILD_AGE_RANGE"
                                    mo-selected="${param.status}"></select>
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label required" >月收入</label>
                        <div class="layui-input-inline">
                            <select name="incomeRange" multiple  lay-tools mo:dict="Charge_Range"
                                    mo-selected="${param.status}"></select>
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label required" >身高</label>
                        <div class="layui-input-inline">
                            <select name="height" multiple  lay-tools mo:dict="Height_Range"
                                    mo-selected="${param.status}"></select>
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label required" >体重</label>
                        <div class="layui-input-inline">
                            <select name="weight"  multiple  lay-tools mo:dict="Weight_Range"
                                    mo-selected="${param.status}"></select>
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label required" >学历</label>
                        <div class="layui-input-inline">
                            <select name="xl"  multiple  lay-tools mo:dict="xl_range"
                                    mo-selected="${param.status}"></select>
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label required" >手机品牌</label>
                        <div class="layui-input-inline">
                            <select name="phoneBrand" multiple  lay-tools  mo:dict="brand_range"
                                    mo-selected="${param.status}"></select>
                        </div>
                    </div>
                    <!--<div class="layui-form-item">
                        <label class="layui-form-label required" >婚姻状态</label>
                       <div class="layui-input-inline">
                            <select name="marryStatus" multiple="multiple" >
                                <option value="已婚">已婚</option>
                                <option value="未婚" >未婚</option>
                                <option value="无所谓">无所谓</option>
                            </select>
                        </div>
                    </div>-->
                    <div class="layui-form-item">
                        <label class="layui-form-label required" >是否有车</label>
                        <div class="layui-input-inline">
                            <select name="carInfo" multiple  lay-tools >
                                <option value="是">是</option>
                                <option value="否" >否</option>
                                <option value="无所谓">无所谓</option>
                            </select>
                        </div>
                    </div>
                   <!-- <div class="layui-form-item">
                        <label class="layui-form-label required" >星座</label>
                        <div class="layui-input-inline">
                            <select name="constellation"  multiple="multiple" mo:dict="Constellation"
                                    mo-selected="${param.status}"></select>
                        </div>
                    </div>-->
                </div>
            </div>
        </div>
        <div class="layui-form-item" style="padding-left: 10px;">
            <button class="layui-btn task-submit" id="taskView"><i class="fa fa-check-circle"></i>发布预览</button>
            <button class="layui-btn task-update"><i class="fa fa-check-circle"></i>确认发布</button>
            <button class="layui-btn btn-secondary close-task"><i class="fa fa-times-circle"></i> 关闭</button>
        </div>
    </form>
</div>
<script th:replace="/common/template :: script"></script>
<script>
    layui.config({
        base: '../../js/',
    })
    layui.use(['layer','upload','form','code'], function () {
        var $ = layui.jquery;
        var layer = layui.layer;
        var upload = layui.upload;
        var form = layui.form;
        form.render();

        // 代码块
        layui.code({
            title: 'html',
            encode: true,
            about: false

        });
        //选择店铺
        $("#chsShop").click(function () {
            window.layerIndex = layer.open({
                content: ['/shop/popShopList', 2]
                , type: 2
                , title: '店铺列表'
                , area: ['600px', '400px']
            });
        });

        //任务浏览
       /* $("#taskView").click(function () {
            window.layerIndex = top.layer.open({
                content: ['/shop/popShopList', 2]
                , type: 2
                , title: '任务浏览'
                , area: ['600px', '400px']
            });
        });*/

        /* 提交表单数据 */
        $(document).on("click", ".task-submit", function (e) {
            e.preventDefault();
            var form = $(this).parents("form");
            var url = form.attr("action");
            var serializeArray = form.serializeArray();
            $.post(url, serializeArray, function (result) {
                if (result.data == null) {
                    layer.msg(result.msg, {offset: '15px', time: 3000, icon: 1});
                }
                if (result.code === 200) {
                    var id=result.data.id;
                    $("#idkey").val(id);
                    if (id){
                        window.layerIndex = top.layer.open({
                            content: ['/task/detail/'+id, 2]
                            , type: 2
                            , title: '任务浏览'
                            , area: ['600px', '400px']
                        });
                    }
                }
            });
        });



        $(document).on("click", ".close-task", function (e) {
            parent.location.reload();
        });

        /* 更新表单数据 */
        $(document).on("click", ".task-update", function (e) {
            e.preventDefault();
            var form = $(this).parents("form");
            var url = "/task/update";
            var serializeArray = form.serializeArray();
            $.post(url, serializeArray, function (result) {
                if (result.data == null) {
                    result.data = 'submit[refresh]';
                }
                if (result.code === 200) {
                    layer.msg(result.msg, {offset: '15px', time: 3000, icon: 1});
                    setTimeout(function () {
                        if (result.data === 'submit[refresh]') {
                            parent.location.reload();
                            return;
                        }
                        if (result.data != null && result.data.url != null) {
                            window.location.href = result.data.url;
                        } else {
                            window.location.reload();
                        }
                    }, 2000);
                } else {
                    layer.msg(result.msg, {offset: '15px', time: 3000, icon: 2});
                }
            });
        });

        //上传宝贝图片
        var babyPic = upload.render({
            elem: '#babyPic'
            ,field: 'picture'
            ,exts: 'jpg|png|gif|jpeg'
            ,url: '/upload/picture' //改成您自己的上传接口
            ,multiple: true
            ,before: function(obj){
                //预读本地文件示例，不支持ie8
                obj.preview(function(index, file, result){
                    $('#babyPicImg').append('<img src="'+ result +'" alt="'+ file.name +'" class="upload-img">')
                });
            }
            ,done: function(res){
                //如果上传失败
                if(res.code == 200){
                    var path=res.data.path;
                    var oldPath=$("#babyPicText").val();
                    var newPath="";
                    if(oldPath!=''){
                        newPath=oldPath +","+path
                    }else{
                        newPath=path;
                    }
                    $("#babyPicText").val(newPath);
                    return layer.msg('上传成功!');
                }else{
                    return layer.msg(res.msg);
                }
            }
            ,error: function(){
            }
        });

    });


</script>
</body>
</html>