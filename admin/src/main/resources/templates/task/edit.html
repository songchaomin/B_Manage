<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:mo="https://gitee.com/aun/Timo">
<head th:replace="/common/template :: header(~{::title},~{::link},~{::style})">
    <style>
        .layui-form .layui-form-item .layui-form-label {
            width: 140px;
        }

        .upload-img {
            width: 80px;
            height: 80px;
            border: 0;
            padding-right: 2px;
        }
    </style>
</head>
<body>
<div class="layui-form timo-compile" style="margin: 0 auto;width: 700px;padding-top: 5px;">
    <form th:action="@{/task/add}">
        <input type="hidden" name="id" th:value="${task.id}">
        <div class="layui-tab layui-tab-card">
            <ul class="layui-tab-title">
                <li class="layui-this">任务基本信息</li>
                <li>任务标签</li>
            </ul>
            <div class="layui-tab-content" style="background-color: white;">
                <div class="layui-tab-item layui-show">
                    <!--基本信息-->
                    <div class="layui-form-item">
                        <label class="layui-form-label required">任务名称</label>
                        <div class="layui-input-inline">
                            <input class="layui-input" type="text" name="taskName" th:value="${task.taskName}" placeholder="请输入任务名称">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label required">任务类型</label>
                        <div class="layui-input-inline">
                            <input type="radio" name="taskType" value="淘宝" title="淘宝" >
                            <input type="radio" name="taskType" value="京东" title="京东">
                            <input type="radio" name="taskType" value="拼多多" title="拼多多">
                            <input type="radio" name="taskType" value="抖音" title="抖音">

                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label required">绑定店铺</label>
                        <div class="layui-input-inline">
                            <input class="layui-input" type="text" name="shopName" id="shopName" th:value="${task.shopName}" placeholder="请选择店铺">
                        </div>
                        <div class="layui-input-inline">
                            <button type="button" class="layui-btn" id="chsShop">选择店铺</button>
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label required">宝贝描述</label>
                        <div class="layui-input-inline">
                            <input class="layui-input" type="text" name="babyLink" th:value="${task.babyLink}"  placeholder="请输入宝贝描述">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label required">宝贝关键字</label>
                        <div class="layui-input-inline">
                            <input class="layui-input" type="text" name="babyKey" th:value="${task.babyKey}"  placeholder="请输入宝贝关键字">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label required">宝贝规格(毛重)</label>
                        <div class="layui-input-inline">
                            <input class="layui-input" type="text" name="babySpec" th:value="${task.babySpec}"  placeholder="请输入宝贝规格">
                        </div>
                        <div class="layui-input-inline">
                            <span>克</span>
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label required">宝贝本金(元)</label>
                        <div class="layui-input-inline">
                            <input class="layui-input" type="text" name="babyPrice" th:value="${task.babyPrice}"  placeholder="请输入宝贝本金">
                        </div>

                        <div class="layui-input-inline">
                            <button type="button" class="layui-btn" id="chsPrice">服务价目表</button>
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label required">是否关注店铺</label>
                        <div class="layui-input-inline">
                            <input type="radio" name="attentionStoreFlag" value="1" title="是" >
                            <input type="radio" name="attentionStoreFlag" value="0" title="否">
                        </div>
                    </div>

                    <div class="layui-form-item">
                        <label class="layui-form-label required">是否收藏宝贝</label>
                        <div class="layui-input-inline">
                            <input type="radio" name="collectBabyFlag" value="1" title="是" >
                            <input type="radio" name="collectBabyFlag" value="0" title="否">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <div class="layui-upload">
                            <label class="layui-form-label required">宝贝主图</label>
                            <div class="layui-input-inline">
                                <button type="button" class="layui-btn" id="babyPic">上传图片</button>
                                <blockquote style="margin-top: 5px;">
                                    <div class="layui-upload-list" id="babyPicImg"></div>
                                </blockquote>
                                <input type="hidden" name="babyPic" id="babyPicText"/>
                            </div>
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label required">任务人数</label>
                        <div class="layui-input-inline">
                            <input class="layui-input" type="text" name="personNum" th:value="${task.personNum}"  placeholder="请输入任务人数">
                        </div>
                        <div class="layui-input-inline">
                            <span>【不可为0】</span>
                        </div>
                    </div>
                </div>
                <div class="layui-tab-item">
                    <!--标签信息-->
                    <div class="layui-form-item">
                        <label class="layui-form-label required" >性别</label>
                        <div class="layui-input-inline">
                            <select name="sex" multiple="multiple" >
                                <option value="男">男</option>
                                <option value="女" >女</option>
                                <option value="无所谓">无所谓</option>
                            </select>
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label required" >年龄</label>
                        <div class="layui-input-inline">
                            <select name="age" multiple="multiple" mo:dict="AGE_RANGE"
                                    mo-selected="${param.status}"></select>
                        </div>
                    </div>
                   <!-- <div class="layui-form-item">
                        <label class="layui-form-label required" >地区</label>
                        <div class="layui-input-inline">
                            <select name="area" multiple="multiple" mo:dict="ARE_RANGE"
                                    mo-selected="${param.status}"></select>
                        </div>
                    </div>-->
                    <div class="layui-form-item">
                        <label class="layui-form-label required" >子女年龄</label>
                        <div class="layui-input-inline">
                            <select name="childAge" multiple="multiple"  mo:dict="CHILD_AGE_RANGE"
                                    mo-selected="${param.status}"></select>
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label required" >月收入</label>
                        <div class="layui-input-inline">
                            <select name="incomeRange" multiple="multiple" mo:dict="Charge_Range"
                                    mo-selected="${param.status}"></select>
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label required" >身高</label>
                        <div class="layui-input-inline">
                            <select name="height" multiple="multiple" mo:dict="Height_Range"
                                    mo-selected="${param.status}"></select>
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label required" >体重</label>
                        <div class="layui-input-inline">
                            <select name="weight"  multiple="multiple" mo:dict="Weight_Range"
                                    mo-selected="${param.status}"></select>
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label required" >淘宝常购品类</label>
                        <div class="layui-input-inline">
                            <div id="xlTree" class="tree"></div>
                            <input type="hidden" name="xl" id="xl">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label required" >手机品牌</label>
                        <div class="layui-input-inline">
                            <select name="phoneBrand" multiple="multiple"  mo:dict="brand_range"
                                    mo-selected="${param.status}"></select>
                        </div>
                    </div>
                 <!--   <div class="layui-form-item">
                        <label class="layui-form-label required" >婚姻状态</label>
                        <div class="layui-input-inline">
                            <select name="marryStatus" multiple="multiple" >
                                <option value="已婚">已婚</option>
                                <option value="未婚" >未婚</option>
                                <option value="无所谓">无所谓</option>
                            </select>
                        </div>
                    </div>-->
                    <div class="layui-form-item">
                        <label class="layui-form-label required" >是否有车</label>
                        <div class="layui-input-inline">
                            <select name="carInfo" multiple="multiple" >
                                <option value="是">是</option>
                                <option value="否" >否</option>
                                <option value="无所谓">无所谓</option>
                            </select>
                        </div>
                    </div>
                   <!-- <div class="layui-form-item">
                        <label class="layui-form-label required" >星座</label>
                        <div class="layui-input-inline">
                            <select name="constellation"  multiple="multiple" mo:dict="Constellation" th:value="${task.constellation}"
                                    mo-selected="${param.status}"></select>
                        </div>
                    </div>-->
                </div>
            </div>
        </div>
        <div class="layui-form-item" style="padding-left: 10px;">
            <button class="layui-btn task-submit"><i class="fa fa-check-circle"></i>确认发布</button>
            <button class="layui-btn btn-secondary close-popup"><i class="fa fa-times-circle"></i> 关闭</button>
        </div>
    </form>
</div>
<script th:replace="/common/template :: script"></script>
<script>
    layui.config({
        base: '../../js/',
    })
    layui.use(['layer','upload','multiSelect','tree','util'], function () {
        var $ = layui.jquery;
        var layer = layui.layer;
        var upload = layui.upload;
        var tree = layui.tree;
        var util = layui.util;
        var multiSelect = layui.multiSelect;


        var data = [{
            title: '服装/箱包'
            ,id: 1
            ,children: [{
                title: '0-50'
                ,id: 5
            },{
                title: '50-100'
                ,id: 6
            },{
                title: '100-200'
                ,id: 7
            },{
                title: '300-500'
                ,id: 8
            },{
                title: '500-1000'
                ,id: 9
            },{
                title: '1000以上'
                ,id: 10
            }]
        },{
            title: '生活用品'
            ,id: 2
            ,children: [{
                title: '0-50'
                ,id: 11
            },{
                title: '50-100'
                ,id: 12
            },{
                title: '100-200'
                ,id: 13
            },{
                title: '300-500'
                ,id: 14
            },{
                title: '500-1000'
                ,id:15
            },{
                title: '1000以上'
                ,id: 16
            }]
        },{
            title: '运动户外'
            ,id: 3
            ,children: [{
                title: '0-50'
                ,id: 17
            },{
                title: '50-100'
                ,id: 18
            },{
                title: '100-200'
                ,id: 19
            },{
                title: '300-500'
                ,id: 20
            },{
                title: '500-1000'
                ,id: 21
            },{
                title: '1000以上'
                ,id: 22
            }]
        },{
            title: '个人护理'
            ,id: 4
            ,children: [{
                title: '0-50'
                ,id: 23
            },{
                title: '50-100'
                ,id: 24
            },{
                title: '100-200'
                ,id: 25
            },{
                title: '300-500'
                ,id: 26
            },{
                title: '500-1000'
                ,id: 27
            },{
                title: '1000以上'
                ,id: 28
            }]
        },{
            title: '食品'
            ,id: 5
            ,children: [{
                title: '0-50'
                ,id: 29
            },{
                title: '50-100'
                ,id: 30
            },{
                title: '100-200'
                ,id: 31
            },{
                title: '300-500'
                ,id: 32
            },{
                title: '500-1000'
                ,id: 33
            },{
                title: '1000以上'
                ,id: 34
            }]
        }];

        tree.render({
            elem: '#xlTree'
            ,data: data
            ,showCheckbox: true
            ,id:'xltree1'
        });
        //选择店铺
        $("#chsShop").click(function () {
            window.layerIndex = layer.open({
                content: ['/shop/popShopList', 2]
                , type: 2
                , title: '店铺列表'
                , area: ['600px', '400px']
            });
        });


        /* 更新表单数据 */
        $(document).on("click", ".task-submit", function (e) {
            e.preventDefault();
            var form = $(this).parents("form");
            var url = "/task/update";
            var checkData = tree.getChecked('xltree1');
            $("#xl").val(JSON.stringify(checkData));
            var serializeArray = form.serializeArray();
            $.post(url, serializeArray, function (result) {
                if (result.data == null) {
                    result.data = 'submit[refresh]';
                }
                if (result.code === 200) {
                    layer.msg(result.msg, {offset: '15px', time: 3000, icon: 1});
                    setTimeout(function () {
                        if (result.data === 'submit[refresh]') {
                            parent.location.reload();
                            return;
                        }
                        if (result.data != null && result.data.url != null) {
                            window.location.href = result.data.url;
                        } else {
                            window.location.reload();
                        }
                    }, 2000);
                } else {
                    layer.msg(result.msg, {offset: '15px', time: 3000, icon: 2});
                }
            });
        });

        //上传宝贝图片
        var babyPic = upload.render({
            elem: '#babyPic'
            ,field: 'picture'
            ,exts: 'jpg|png|gif|jpeg'
            ,url: '/upload/picture' //改成您自己的上传接口
            ,multiple: true
            ,before: function(obj){
                //预读本地文件示例，不支持ie8
                obj.preview(function(index, file, result){
                    $('#babyPicImg').append('<img src="'+ result +'" alt="'+ file.name +'" class="upload-img">')
                });
            }
            ,done: function(res){
                //如果上传失败
                if(res.code == 200){
                    var path=res.data.path;
                    var oldPath=$("#babyPicText").val();
                    var newPath="";
                    if(oldPath!=''){
                        newPath=oldPath +","+path
                    }else{
                        newPath=path;
                    }
                    $("#babyPicText").val(newPath);
                    return layer.msg('上传成功!');
                }else{
                    return layer.msg(res.msg);
                }
            }
            ,error: function(){
            }
        });

    });


</script>
</body>
</html>